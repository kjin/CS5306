<!doctype html>
<html>
  <head>
    <title>Literally Canvas</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>

  <body onload="requestComparisons()">
    <div id="whole">
      <div align="center">
        <b>Instructions:</b> For each pair of images, choose the one that is more visually appealing to you.
        You must choose one option for each pair. When you are finished, click the "Submit" button at the bottom of this page.
      </div>
      <div align="center">
        <table style="width:100%" border="1" id="comparisons">
        </table>
        <button onclick="submitPreferences">Submit</button>
      </div>
      <div align="center" id="messages"></div>
    </div>

    <script src="static/jquery-1.8.2.js"></script>
    <script type="text/javascript">
      var userID = 0; // TODO: Randomly generate this value
      var numPairsToLoad = 10;

      // Returns two imageIDs to compare pictures against
      function requestComparisons() {
        jQuery.get("evalTaskGetImages.php?userID=" + userID + "&numTimes=" + numPairsToLoad, loadComparisons);
      }

      function loadComparisons(result) {
        var pairStrings = result.split(';');
        numPairsToLoad = pairStrings.length;
        for (var i = 0; i < pairStrings.length; i++)
        {
          var values = pairStrings[i].split(',');
          if (values.length == 1)
          {
            values = ["4101", "4105"];
          }
          document.getElementById("comparisons").innerHTML += setupTableRow(i, values[0], values[1]);
        }
      }
      
      function submitPreferences() {
        var result = "";
        for (var i = 0; i < numPairsToLoad; i++)
        {
          var elements = document.getElementsByName("comparison" + i);
          if (elements[0].checked || elements[1].checked)
          {
            if (i > 0)
            {
              result += ";";
            }
            if (elements[0].checked)
            {
              result += elements[0].value + "," + elements[1].value;
            }
            else
            {
              result += elements[1].value + "," + elements[0].value;
            }
          }
          else
          {
            document.getElementsById("messages").innerHTML = "<font color=\"red\">One or more pairs of images are missing a rating.</font>"
            return;
          }
        }
        jQuery.post("evalTaskFinish.php?userID=" + userID, result, displayUniqueToken);
      }
      
      function displayUniqueToken(result) {
        document.getElementById().innerHTML = "Please copy the following ID into the token box in Mechanical Turk: <b>" + result + "</b>";
      }
      
      function setupTableRow(pairNumber, imageID1, imageID2)
      {
        var result = "<tr>";
        result += setupTableCell(pairNumber, imageID1);
        result += setupTableCell(pairNumber, imageID2);
        result += "</tr>";
        return result;
      }
      
      // Returns the inner HTML for a table cell
      function setupTableCell(pairNumber, imageID) {
        var imageURL = "files/" + imageID + ".png";
        var result = "<td><div align=\"center\">";
        result += "<img src=\"" + imageURL + "\" width=\"100%\"/><br />";
        result += "I prefer this <input type=\"radio\" name=\"comparison" + pairNumber + "\" value=\"" + imageID + "\">";
        result += "</div></td>";
        return result;
      }
    </script>
  </body>
</html>
